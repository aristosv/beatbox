function start_browser {

# removing old service file
[ -e /etc/systemd/system/browser.service ] && sudo rm /etc/systemd/system/browser.service

# creating new service file
echo '[Unit]' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
echo 'Description=Digital Signage Browser' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
echo 'After=network.target' | sudo tee -a /etc/systemd/system/browser.service > /dev/null

echo '[Service]' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
echo 'ExecStart=/bin/bash -c "export DISPLAY=:0.0 ; sudo xinit /usr/bin/chromium-browser @option.Website_Address@ -no-sandbox --window-size=1920,1080 --start-fullscreen --kiosk --incognito --noerrdialogs --disable-translate --no-first-run --fast --fast-start --disable-infobars --disk-cache-dir=/dev/null"' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
echo 'Restart=always' | sudo tee -a /etc/systemd/system/browser.service > /dev/null

echo '[Install]' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
echo 'WantedBy=multi-user.target' | sudo tee -a /etc/systemd/system/browser.service > /dev/null

# reloading systemctl
sudo systemctl daemon-reload

# clearing framebuffer
dd if=/dev/zero of=/dev/fb0 status=none > /dev/null 2>&1 &

# starting browser service
sudo systemctl start browser.service

# enabling browser service
sudo systemctl enable browser.service > /dev/null 2>&1
}

function stop_browser {

# stopping browser service
sudo systemctl stop browser.service

# clearing framebuffer
dd if=/dev/zero of=/dev/fb0 status=none > /dev/null 2>&1 &

# showing logo
fim -q /home/pi/media/logo/bbx.png > /dev/null 2>&1 &

# disabling browser service
sudo systemctl disable browser.service > /dev/null 2>&1

# deleting browser service
[ -e /etc/systemd/system/browser.service ] && sudo rm /etc/systemd/system/browser.service    
}

if [ $(systemctl show -p SubState browser) = SubState=running ]
then
echo browser is running
echo restarting browser
 stop_browser
 start_browser
else
echo browser is not running
echo starting browser
 start_browser
fi
