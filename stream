function start_stream {

# removing old service file
[ -e /etc/systemd/system/stream.service ] && sudo rm /etc/systemd/system/stream.service

# creating new service file
echo '[Unit]' | sudo tee -a /etc/systemd/system/stream.service > /dev/null
echo 'Description=Digital Signage Stream' | sudo tee -a /etc/systemd/system/stream.service > /dev/null
echo 'After=network.target' | sudo tee -a /etc/systemd/system/stream.service > /dev/null

echo '[Service]' | sudo tee -a /etc/systemd/system/stream.service > /dev/null
echo 'ExecStart=/bin/bash -c "omxplayer --no-keys --no-osd --loop $(youtube-dl -g -f best @option.YouTube_Video_Link_Stream@)"' | sudo tee -a /etc/systemd/system/stream.service > /dev/null
echo 'Restart=always' | sudo tee -a /etc/systemd/system/stream.service > /dev/null

echo '[Install]' | sudo tee -a /etc/systemd/system/stream.service > /dev/null
echo 'WantedBy=multi-user.target' | sudo tee -a /etc/systemd/system/stream.service > /dev/null

# reloading systemctl
sudo systemctl daemon-reload

# clearing framebuffer
dd if=/dev/zero of=/dev/fb0 status=none > /dev/null 2>&1 &

# starting stream service
sudo systemctl start stream.service

# enabling stream service
sudo systemctl enable stream.service > /dev/null 2>&1
}

function stop_stream {

# stopping stream service
sudo systemctl stop stream.service

# clearing framebuffer
dd if=/dev/zero of=/dev/fb0 status=none > /dev/null 2>&1 &

# showing logo
fim -q /home/pi/media/logo/bbx.png > /dev/null 2>&1 &

# disabling stream service
sudo systemctl disable stream.service > /dev/null 2>&1

# deleting stream service
[ -e /etc/systemd/system/stream.service ] && sudo rm /etc/systemd/system/stream.service    
}

if [ $(systemctl show -p SubState youtube) = SubState=running ]
then
echo stream is running
echo restarting stream
 stop_stream
 start_stream
else
echo stream is not running
echo starting stream
 start_stream
fi
