stop_service ()
{
 for service in audio video images stream youtube browser logo
 do
  sudo systemctl is-active --quiet $service.service &&
  sudo systemctl stop $service.service &&
  sudo systemctl disable $service.service  > /dev/null 2>&1 &&
  sudo rm /etc/systemd/system/$service.service &&
  echo stop $service
 done
}

clear_framebuffer ()
{
 dd if=/dev/zero of=/dev/fb0 status=none > /dev/null 2>&1 &
}

start_service ()
{
 echo '[Unit]' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo 'Description=digital signage browser' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo 'After=network.target' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo '[Service]' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo 'ExecStart=/bin/bash -c "export DISPLAY=:0.0 ; sudo startx /usr/bin/chromium-browser $browserlink -no-sandbox --window-size=9000,9000 --start-fullscreen --kiosk --incognito --noerrdialogs --disable-translate --no-first-run --fast --fast-start --disable-infobars --disk-cache-dir=/dev/null"' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo 'Restart=always' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo '[Install]' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 echo 'WantedBy=multi-user.target' | sudo tee -a /etc/systemd/system/browser.service > /dev/null
 sudo systemctl daemon-reload
 sudo systemctl start browser.service
 sudo systemctl enable browser.service > /dev/null 2>&1
}

stop_service ; clear_framebuffer
echo start browser ; start_service
